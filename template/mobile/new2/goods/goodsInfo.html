<include file="public/header" title="商品详情" body=""/>
<link rel="stylesheet" type="text/css" href="__STATIC__/css/swiper.min.css"/>
<head>
    <meta property="og:type" content="website" />
    <meta property="og:title" content="{$goods['goods_name']}">
    <meta property="og:description" content="{$goods['goods_remark']}">
    <meta property="og:image" content="{$goods_images_list[0]['image_url']}">
</head>
<style>
    .qiehuan{
        overflow: unset;
    }
    #real{
        /*点击弹出模态框的图片*/
        margin: 30px;
        width: 250px;
        border-radius:6px;
    }
    #real:hover{
        opacity: 0.6;
    }
    #mo{
        display: none;/*隐藏*/
        width: 100%;
        height: 100%;
        position: absolute;
        overflow: auto;
        background-color: rgba(0,0,0,0.7);
        top: 10%;
        left: 0px;
        z-index: 55;
    }
    #moimg{
        display: block;
        margin:25px auto;
        width: 60%;
        max-width: 750px;
    }
    #caption{
        text-align: center;
        margin: 15px auto;
        width: 60%;
        max-height: 750px;
        font-size: 20px;
        color:#ccc;
    }
    #moimg,#caption{
        -webkit-animation: first 1s;
        -o-animation: first 1s;
        animation: first 1s;
    }
    @keyframes first{
        from{transform: scale(0.1);}
        to{transform: scale(1);}
    }
    .close{
        font-size: 40px;
        font-weight: bold;
        position: absolute;
        right: 0%;
        color:#f1f1f1;
    }
    .close:hover,
    .close:focus{
        color:#bbb;
        cursor:pointer;
    }
    @media only screen and(max-width:750px ) {
        #moimg{
            width: 100%;
        }
    }
    .content30{
        margin-top: .1rem;
    }
    .detailsfloo .myorder .order .fl span{
        float: none;
    }
    .detailban .mslide{
        min-height: 14rem;
    }
</style>

<!--<script src="__STATIC__/js/jquery-1.10.1.min.js" type="text/javascript" charset="utf-8"></script>-->
<script src="__STATIC__/js/swiper.min.js" type="text/javascript" charset="utf-8"></script>



    <div class="he_sustain">
    <div class="classreturn loginsignup detail">
        <div class="content">
            <div class="ds-in-bl return">
                <a href="javascript:history.back(-1)"><img src="__STATIC__/images/return.png" alt="返回"></a>
            </div>
            <div class="ds-in-bl search center" id="tab">
                <span class="sxp">商品</span>
                <span>详情</span>
                <span>评论</span>
            </div>
            <div class="ds-in-bl menu">
                <a href="javascript:void(0);"><img src="__STATIC__/images/class1.png" alt="菜单"></a>
            </div>
        </div>
    </div>
</div>

<!--顶部隐藏菜单-s-->
<include file="public/top_nav"/>
<!--顶部隐藏菜单-e-->
<!--商品抢购 start-->
<!--商品s-->
<div class="swiper-container">
    <div class="swiper-wrapper">
        <div class="swiper-slide">
<div class="xq_details">

    <div class="banner ban1 detailban">
        <div class="mslide" id="slideTpshop">
            <ul>
                <!--图片-s-->
                <foreach name="goods_images_list" item="pic">
                    <li><a href="javascript:void(0)"><img src="{$pic[image_url]}" alt=""></a></li>
                </foreach>
                <!--图片-e-->
            </ul>
        </div>
    </div>
    <div class="de_font p">
        <div class="thirty" style="padding-bottom: 0rem">
            <div style="margin: 0.5rem auto 0.2rem auto;border:none;">
                <span class="similar-product-text">{$goods.goods_name}</span>
            </div>

            <p style="clear:both;margin-bottom: 0.1rem;color:#f00;font-size:0.58rem;line-height: 1.2em;">{$goods.goods_remark}</p>
           <!-- <div>
                <p class="fl" style="width: 55%;text-align: left;color: #999999;font-size: 0.55rem;margin-top: .7333rem;font-weight: normal;">已售<span class="red">{$goods.sales_sum}</span>件</p>
            </div>-->

            <div class="scunde p">
                <!--<div class="fl">-->
					<!--<p>商城价格：<span id="price"  class="red">￥{$goods.shop_price}</span></p>-->
                    <!--<p>专柜价格：<span class="linethr">{$goods.market_price}</span></p>-->
                <!--可 &nbsp; &nbsp; &nbsp; 用：-->
                <if condition="$goods['shop_price'] gt 0">
                <p>
						<span class="red" style="font-size: 0.75rem">
							<if condition="$goods['exchange_integral'] gt 0">
                                <if condition="($goods[shop_price]-$goods['exchange_integral']/$point_rate) gt 0">
									<small>￥</small><php>echo number_format($goods[shop_price]-$goods['exchange_integral']/$point_rate,2);</php>+{$goods['exchange_integral']}<small>积分</small>
                                <else />
                                        {$goods['exchange_integral']}积分
                                </if>

							<else />
								<small>￥</small><php>echo number_format($goods[shop_price]-$goods['exchange_integral']/$point_rate,2);</php>
                        	</if>
						</span>
                        <if condition="$goods['give_integral'] gt 0">
                            <em style="color: #999999;font-size: .65rem" ">&nbsp; 赠送<em class="red" style="font-size: .7rem">{$goods.give_integral}</em>积分</em>
                        </if>
						&nbsp; &nbsp; <span style="color: #999999;font-size: .65rem" ">已售<em class="red" style="font-size: .7rem">{$goods.sales_sum}</em>件</span>
                    </p>
                <else / >
                    <p>
                        <span class="red" style="font-size: 0.75rem">
                            <small>￥</small>预约报价
                        </span>
                    </p>
                </if>
					<!--<p>当前库存：<span><empty name="goods['flash_sale']">{$goods.store_count}<else/>{$goods.flash_sale.goods_num-$goods.flash_sale.buy_num}</empty></span></p>-->
                <!--</div>-->

                <!--<div class="keep fr">
                    已售<span class="red">{$goods.sales_sum}</span>件
                    <a href="javascript:collect_goods({$goods.goods_id});" id="favorite_add">
                        &lt;!&ndash;<i class=" <if condition='$collect gt 0'>red</if>"></i>&ndash;&gt;
                        <span>收藏</span>
                    </a>
                </div>-->
            </div>
            <if condition="$goods['market_price'] gt 0 ">
                <div style="color: #999999;font-size: 0.6rem;margin-top: 0.5rem">
                    <span>专柜价：</span>
                    <span class="though-line" style="font-size: 0.65rem"><em>￥</em>{$goods.market_price}</span>
                </div>
                <else/>
                <div style="color: #999999;font-size: 0.6rem;margin-top: 0.5rem">


                </div>
            </if>
        </div>

    </div>

    <div class="floor list7 detailsfloo">
        <!--配送至-s-->
        <div class="container" >
            <div class="city">
                <div class="screen_wi_loc">
                    <div class="classreturn loginsignup">
                        <div class="content">
                            <div class="ds-in-bl return seac_retu">
                                <a href="javascript:void(0);" onclick="closelocation();"><img src="__STATIC__/images/return.png" alt="返回"></a>
                            </div>
                            <div class="ds-in-bl search center">
                                <span class="sx_jsxz">配送至</span>
                            </div>
                            <div class="ds-in-bl suce_ok">
                                <a href="javascript:void(0);">&nbsp;</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="province-list"></div>
                <div class="city-list" style="display:none"></div>
                <div class="area-list" style="display:none"></div>
            </div>
        </div>
        <!--配送至-e-->

        <div id="balance" class="chidno"></div>
        <!--运费-s-->
        <div class="myorder p choise_num">
            <div class="content30">
                <a href="javascript:void(0)">
                    <div class="order">
                        <div class="fl">
                            <span class="firde" style="color: #EC5151">已选</span>
                            <span class="sel"></span>
                        </div>
                        <div class="fr">
                            <i class="Mright"></i>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        <!--<div class="myhearders myorder">-->
            <!--<div class="scgz descgz">-->
                <!--<ul>-->
                    <!--<li>-->
                        <!--<a href="javascript:void(0);">-->
                            <!--<img src="__STATIC__/images/hdfk.png">-->
                            <!--<p>多种付款</p>-->
                        <!--</a>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<a href="javascript:void(0);">-->
                            <!--<img src="__STATIC__/images/qttk.png">-->
                            <!--<p>七天退款</p>-->
                        <!--</a>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<a href="javascript:void(0);">-->
                            <!--<img src="__STATIC__/images/ksd.png">-->
                            <!--<p>极速达</p>-->
                        <!--</a>-->
                    <!--</li>-->
                <!--</ul>-->
            <!--</div>-->
        <!--</div>-->
        <div class="myorder p seedeadei">
            <div class="content30">
                <a href="javascript:void(0)">
                    <div class="order">
                        <div class="fl">
                            <span class="firde red">查看商品详情</span>
                        </div>
                        <div class="fr">
                            <i class="Mright"></i>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        <div class="myorder p tbv">
            <div class="content30">
                <a href="javascript:void(0)">
                    <div class="order">
                        <div class="fl">
                            <span class="firde">用户评价</span>
                            <span>好评率<i>
                                <if condition="!empty($commentStatistics.c1) and !empty($commentStatistics.c0)">
                                 {:round($commentStatistics.c1/$commentStatistics.c0,3)*100}%
                                <else/>100%</if>
                            </i></span>
                        </div>
                        <div class="fr">
                            <span><i>{$commentStatistics.c0}</i>人评论</span>
                            <i class="Mright"></i>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <div class="recommed p">
        <h2>为您推荐</h2>
        <div class="floor guesslike">
            <div class="likeshop">
                <ul>
                    <!--商品推荐-->
                    <tpshop sql="SELECT * FROM __PREFIX__goods WHERE ( is_recommend=1 and is_on_sale=1 ) ORDER BY goods_id DESC LIMIT 0,6 " key="k" item='v'>
                        <li>
                            <a href="{:U('Goods/goodsInfo',array('id'=>$v[goods_id],'first_leader'=>$_COOKIE['user_id']))}">
                                <div class="similer-product" style="width: 100%;">
                                    <img src="{$v.goods_id|goods_thum_images=400,400}">
                                    <span class="similar-product-text" style="width: 100%;white-space:nowrap;overflow: hidden;text-overflow:ellipsis;display: block">{$v[goods_name]}</span>
                                    <span class="similar-product-price">
                                         <if condition="$v['exchange_integral'] gt 0">
                                            <if condition="($v[shop_price]-$v['exchange_integral']/$point_rate) gt 0">
												<span class="price" style="font-size: 0.525rem"><small>￥</small><php>echo number_format($v[shop_price]-$v['exchange_integral']/$point_rate,0);</php>+{$v['exchange_integral']}<small>积分</small></span>
											<else />
                                                <span class="big-price">{$v['exchange_integral']}<small>积分</small></span>
                                            </if>
                                            <else/>
                                             <if condition="$v[shop_price] gt 0">
                                            <span class="big-price"><small>￥</small>{$v[shop_price]}<small>元</small></span>
                                            <else />
                                                <span class="big-price"><small>￥</small>预约报价</span>

                                    </if>
                                        </if>
                                        <!--¥<span class="big-price">{$v[shop_price]}</span>-->
                                    </span>
                                </div>
                            </a>
                        </li>
                    </tpshop>
                </ul>
            </div>
        </div>
    </div>
<!--添加购物车JS-->
<script src="__PUBLIC__/js/mobile_common.js" type="text/javascript" charset="utf-8"></script>
</div>
<!--商品-e-->
        </div>
<!--详情-s-->
        <div class="swiper-slide">
    <div class="xq_details" style="display: ">

    <!--<div class="spxq-ggcs">-->
        <!--<ul>-->
            <!--<li class="red">商品详情</li>-->
            <!--<li>规格参数</li>-->
        <!--</ul>-->
    <!--</div>-->
    <div class="sg">
        <div class="spxq p">
            {$goods.goods_content|htmlspecialchars_decode}
        </div>
    </div>
    <div class="sg" style="display: none;">
        <div class="spxq p">
            <table class="de_table" border="1" bordercolor="#cbcbcb" style="border-collapse:collapse;">
                <tr>
                    <th colspan="2">主体</th>
                </tr>
                <foreach name="goods_attr_list" item="v" key="k" >
                    <tr>
                        <td>{$goods_attribute[$v[attr_id]]}</td>
                        <td>{$v[attr_value]}</td>
                    </tr>
                </foreach>
            </table>
        </div>
    </div>
</div>
<!--详情-e-->
        </div>
<!--评论列表-s-->
        <div class="swiper-slide">
    <div class="xq_details" style="margin-bottom: 1rem">

    <div class="spxq-ggcs comment_de p"  style="display:;">
        <ul>
            <!--1 全部 2好评 3 中评 4差评-->
            <li class="red">全部评价 <br /><span ctype="1">{$commentStatistics.c0}</span></li>
            <li>好评 <br /><span ctype="2">{$commentStatistics.c1}</span></li>
            <li>中评 <br /><span ctype="3">{$commentStatistics.c2}</span></li>
            <li>差评 <br /><span ctype="4">{$commentStatistics.c3}</span></li>
            <li>有图 <br /><span ctype="5">{$commentStatistics.c4}</span></li>
        </ul>
    </div>
    <!--评论列表-->
    <div class="tab-con-wrapper my_comment_list" > </div>
</div>
<!--评论列表-e-->
        </div>
    </div>
</div>
<!--底部按钮-s-->
    <div class="podee" style="height:2rem">
    <div class="cart-concert-btm p">
        <div class="fl">
            <ul>
                <li>
                    <!--<a href="tencent://message/?uin={$tpshop_config['shop_info_qq']}&Site=QQ&Menu=yes">-->
                    <a href="tel:{$tpshop_config['shop_info_phone']}">
                        <i></i>
                        <p>客服</p>
                    </a>
                </li>
                <li>
                    <a href="javascript:collect_goods({$goods.goods_id});" id="favorite_add">
                        <i class="<if condition='$collect gt 0'>red sc<else/>sc</if>"></i>
                        <p>收藏</p>
                    </a>
                </li>
                <li>
                    <a href="{:U('Mobile/Cart/cart')}" >
                        <span id="tp_cart_info" style="display: none;"></span>
                        <i class="gwc"></i>
                        <p>购物车</p>
                    </a>
                </li>
            </ul>
        </div>
        <div class="fr">
            <if condition="$goods.shop_price eq 0">
                <ul>
                    <li class="o">
                        <a class="pb_plusshopcar button active_button " href="tel:{$tpshop_config['shop_info_phone']}"> 快速预约</a>
                    </li>
                    <li class="r">
                        <a style="display:block;" href="javascript:void(0);"  onclick="AddService({$goods.goods_id});">一对一服务</a>
                    </li>
                </ul>
                <else />
            <ul>
                <li class="o">
                    <a class="pb_plusshopcar button active_button " href="javascript:void(0);" onClick="AjaxAddCart({$goods.goods_id},1,0);"> 加入购物车</a>
                </li>
                <li class="r">
                    <a style="display:block;" href="javascript:void(0);"  onclick="AjaxAddCart({$goods.goods_id},1,1);">立即购买</a>
                </li>
            </ul>
            </if>
        </div>
    </div>
</div>
<!--底部按钮-e-->

<!--点赞弹窗-s-->
<div class="alert">
    <img src="__STATIC__/images/hh.png"/>
    <p>您已经赞过了！</p>
</div>
<!--点赞弹窗-e-->

<!--选择属性的弹窗-s-->
<form name="buy_goods_form" method="post" id="buy_goods_form" >
    <div class="choose_shop_aready p">
        <!--商品信息-s-->
        <div class="shop-top-under p">
            <div class="maleri30">
                <div class="shopprice">
                    <div class="img_or fl">
                        <!--<a href="{$goods.original_img}"> -->
                            <img id="zoomimg"  src="{$goods.original_img}" >

                        <!--</a>-->
                    </div>
                    <div class="motai" id="mo">

                        <img class="motaiimg" id="moimg">
                        <span class="close" id="close"><img src="__STATIC__/images/icogantanhao-sb.png" style="background-color: white;display: inline-block; height: auto;max-width: 50%;"></span>
                        <div id="caption"></div>
                    </div>
                    <div class="fon_or fl">
                        <h2 class="similar-product-text">{$goods.goods_name}</h2>
                        <input type="hidden" id="goods_name" name="goods_id" value="{$goods.goods_id}">
                        <div class="price_or" id="goods_price">
                            <small>￥</small>
                            <span><if condition="$goods.shop_price gt 0">{$goods.shop_price}<else/>预约报价</if></span>
                        </div>
                        <!--<div class="dqkc_or"><span>剩余库存：</span><span id="store_count">{$goods.store_count}</span></div>-->
                    </div>
                    <div class="price_or fr">
                        <i class="xxgro"></i>
                    </div>
                </div>
            </div>
        </div>
        <!--商品信息-e-->
        <div class="shop-top-under p">
            <div class="maleri30">
                <div class="shulges p">
                    <p>数量</p>
                    <!--选择数量-->
                    <div class="plus">
                        <span class="mp_minous" onclick="altergoodsnum(-1)">-</span>
                                <span class="mp_mp">
                        <input type="text" class="num" id="number" residuenum="{$goods.store_count}" name="goods_num" value="1" max="" onblur="altergoodsnum(0)">
                                </span>
                        <span class="mp_plus" onclick="altergoodsnum(1)">+</span>
                    </div>
                    <script>
                        $('#number').val(1);
                    </script>
                </div>
                <empty name="goods['flash_sale']">
                    <if condition="$filter_spec neq ''">
                        <foreach item="spec" key="key" name="filter_spec">
                            <div class="shulges p choicsel" >
                                <p>{$key}</p>
                                <!-------商品属性值-s------->
                                <foreach name="spec" item="v2" key="k2">
                                    <div class="plus choic-sel">
                                        <a  href="javascript:;" title="{$v2[item]}" onclick="switch_spec(this);<if condition="!empty($v2[src])" > $('#zoomimg').attr('src','{$v2[src]}')</if>"  <if condition="$k2 eq 0">class="hover"</if>>
                                        <input type="radio" style="display:none;" name="goods_spec[{$key}]" value="{$v2[item_id]}" <if condition="$k2 eq 0 ">checked="checked"</if>/>{$v2[item]}
                                        </a>
                                    </div>
                                </foreach>
                                <!-------商品属性值-e-------->
                            </div>
                        </foreach>
                    </if>
                </empty>
            </div>
        </div>
    <if condition="$goods.shop_price gt 0 ">
        <div class="plusshopcar-buy p">
            <a class="pb_plusshopcar button active_button " href="javascript:void(0);" onClick="AjaxAddCart({$goods.goods_id},1,0);">加入购物车</a>
            <a class="pb_buy" href="javascript:void(0);"  onclick="AjaxAddCart({$goods.goods_id},1,1);">立即购买 </a>
        </div>
    <else / >
        <div class="plusshopcar-buy p">
            <a class="pb_plusshopcar button active_button "  href="tel:{$tpshop_config['shop_info_phone']}">快速预约</a>
            <a class="pb_buy" href="javascript:void(0);"  onclick="AddService({$goods.goods_id});">一对一服务 </a>
        </div>
    </if>
    </div>
</form>
<!--选择属性的弹窗-e-->

<div class="mask-filter-div" style="display: none;"></div>
<script>
    var mySwiper = new Swiper('.swiper-container', {

        observer:true,//修改swiper自己或子元素时，自动初始化swiper
        observeParents:true,//修改swiper的父元素时，自动初始化swiper
        autoHeight: true,

        on: {
            slideChangeTransitionStart: function(){
                $(".swiper-wrapper").css('height','');
                mySwiper.slideTo(this.activeIndex, 500);
                window.scrollTo(0,0)
            },
            transitionEnd: function (swiper) {
                var activeHight=$(".swiper-slide").eq(this.activeIndex).height();
                if(activeHight < '650'){
                    $(".swiper-container").css('height','20rem')
                }else{
                    $(".swiper-container").css('height',activeHight)
                }

                $(".swiper-wrapper").css('height','');
                $('.detail .search span').eq(mySwiper.activeIndex).addClass('sxp').siblings().removeClass('sxp');
            },
        },
    });
    $('.detail .search span').click(function() {

        $(this).addClass('sxp').siblings().removeClass('sxp');
        var a = $('.detail .search span').index(this);
        mySwiper.slideTo(a, 500);
        window.scrollTo(0,0)
    })
    $('.seedeadei').click(function(){
        mySwiper.slideTo(1, 500);
        window.scrollTo(0,0)
    })
    $('.tbv').click(function(){
        mySwiper.slideTo(2,500);
        window.scrollTo(0,0)
    })

</script>




<script type="text/javascript" src="__STATIC__/js/mobile-location.js"></script>
<script>
    var motai=document.getElementById('mo')
    var moimg=document.getElementById("moimg")
    var realimg=document.getElementById("zoomimg")
    var caption=document.getElementById("caption")
    realimg.onclick=function(){
        motai.style.display="block"
        moimg.src=this.src
        caption.innerHTML=this.alt
    }
    var span=document.getElementById("close");
    span.onclick=function(){
        motai.style.display="none";
    }
</script>
<script type="text/javascript">
    //一对一服务
    function AddService(goods_id){
        window.location.href="{:U('Mobile/Goods/addService')}?goods_id="+goods_id;
    }

    function  ajax_sourch_submit_hide(){
        $('.getmore').hide();
    }

    /**
     * 点击收藏商品
     */
    function collect_goods(goods_id){
        $.ajax({
            type : "GET",
            dataType: "json",
            url:"/index.php?m=Home&c=goods&a=collect_goods&goods_id="+goods_id,//+tab,
            success: function(data){
                layer.open({content:data.msg, time:2});
                if(data.status == '1'){
                    //收藏点亮
                    $('.de_font .keep').find('i').addClass('red');
                }
            }
        });
    }

    //将选择的属性添加到已选
    function sel(){
        var residuenum = parseInt($('.num').attr('residuenum'));
        var title ='';
        $('.choicsel').find('a').each(function(i,o){   //获取已选择的属性，规格
            if ($(o).hasClass('red')) {
                title += $(o).attr('title')+'&nbsp;&nbsp;';
            }
        })
        var num = $('.num').val();
        if(num > residuenum ){
            layer.open({content:'当前商品最多可购买'+residuenum+'件',time:2})
            num = residuenum;
        }
        var sel = title+'&nbsp;&nbsp;'+num+'件';
        $('.sel').html(sel);
    }

    /**
     * 加减数量
     * n 点击一次要改变多少
     * maxnum 允许的最大数量(库存)
     * number ，input的id
     */
    function altergoodsnum(n){
        var num = parseInt($('#number').val());
        var maxnum = parseInt($('#number').attr('max'));
        num += n;
        num <= 0 ? num = 1 :  num;
        if(num >= maxnum){
            $(this).addClass('no-mins');
            num = maxnum;
        }
        $('#store_count').text(maxnum-num); //更新库存数量
        $('#number').val(num)
    }
    //页面加载后执行
$(document).ready(function(){
    //普通浏览器分享微信
     share_url = window.location.href;
     meta="<meta property='og:url' content='share_url' />";
    $("head").prepend(meta);

    var imgUrl = "http://{$_SERVER[HTTP_HOST]}{$goods[goods_id]|goods_thum_images=400,400}"; // 分享后展示的一张图片
    var lineLink = share_url; // 点击分享后跳转的页面地址
    var descContent = "{$goods['goods_remark']}"; // 分享后的描述信息
    var shareTitle = "{$goods['goods_name']}"; // 分享后的标题
    $.ajax({
        type: "POST",
        async: false,
        url: "/index.php?m=Mobile&c=Index&a=ajaxGetWxConfig&t=" + Math.random(),
        data: {'askUrl': encodeURIComponent(location.href.split('#')[0])},
        dataType: 'JSON',
        success: function (res) {
            appid = res.appId; // 应用id,如果有可以填，没有就留空
        }
    })

    function shareFriend() {
        WeixinJSBridge.invoke('sendAppMessage',{
            "appid": appid,
            "img_url": "http://{$_SERVER[HTTP_HOST]}{$goods[goods_id]|goods_thum_images=400,400}",
            "img_width": "200",
            "img_height": "200",
            "link": lineLink,
            "desc": descContent,
            "title": shareTitle
        }, function(res) {
            //_report('send_msg', res.err_msg); // 这是回调函数，必须注释掉
        })
    }
    function shareTimeline() {
        WeixinJSBridge.invoke('shareTimeline',{
            "img_url": imgUrl,
            "img_width": "200",
            "img_height": "200",
            "link": lineLink,
            "desc": descContent,
            "title": shareTitle
        }, function(res) {
            //_report('timeline', res.err_msg); // 这是回调函数，必须注释掉
        });
    }
    function shareWeibo() {
        WeixinJSBridge.invoke('shareWeibo',{
            "content": descContent,
            "url": lineLink,
        }, function(res) {
            //_report('weibo', res.err_msg);
        });
    }
    // 当微信内置浏览器完成内部初始化后会触发WeixinJSBridgeReady事件。
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
        // 发送给好友
        WeixinJSBridge.on('menu:share:appmessage', function(argv){
            shareFriend();
        });
        // 分享到朋友圈
        WeixinJSBridge.on('menu:share:timeline', function(argv){
            shareTimeline();
        });
        // 分享到微博
        WeixinJSBridge.on('menu:share:weibo', function(argv){
            shareWeibo();
        });
    }, false);
        /**
         * ajax请求购物车列表
         */
        var cart_cn = getCookie('cn');
        if(cart_cn == ''){
            $.ajax({
                type : "GET",
                url:"/index.php?m=Home&c=Cart&a=header_cart_list",//+tab,
                success: function(data){
                    cart_cn = getCookie('cn');
                }
            });
        }
        if(cart_cn>0) {
			$('#tp_cart_info').html(cart_cn).show();
		}
        /**
         * 查看商品详情
         */
        // $('.seedeadei').click(function(){
        //     $('.xq_details').eq(0).hide();
        //     $('.xq_details').eq(1).show();
        //     $('body').animate({ scrollTop: 0 }, 0);
        //     $('.detail').find('.center').find('span').eq(1).addClass('sxp');
        //     $('.detail').find('.center').find('span').eq(0).removeClass('sxp');
        // })

        /**
         * 评论
         */
        // $('.tbv').click(function(){
        //     $('.xq_details').eq(0).hide();
        //     $('.xq_details').eq(2).show();
        //     $('body').animate({ scrollTop: 0 }, 0);
        //     $('.detail').find('.center').find('span').eq(2).addClass('sxp');
        //     $('.detail').find('.center').find('span').eq(0).removeClass('sxp');
        //     $('.gizle').show();
        // })

        /**
         * 加载评论
         */
        commentType = 1; // 评论类型
        ajaxComment(1,1);// ajax 加载评价列表

        /**
         * 加载更多评论
         */
        function ajaxComment(commentType,page){
            $.ajax({
                type : "GET",
                url:"/index.php?m=Mobile&c=goods&a=ajaxComment&goods_id={$goods['goods_id']}&commentType="+commentType+"&p="+page,//+tab,
                success: function(data){
                    $(".my_comment_list").empty().append(data);
                }
            });
        }

        //点赞
        function hde(){
            setTimeout(function(){
                $('.alert').hide();
            },1200)
        }

        /**
         * 已选
         */
        $('.choise_num').click(function(){
            cover();
            $('.choose_shop_aready').show();
            $('.podee').hide();
        })

        //关闭属性选择
        $('.xxgro').click(function(){
            undercover();
            $('.choose_shop_aready').hide();
            $('.podee').show();
            sel();
        })

        /**
         * 规格选择
         */
        $('.choic-sel a').click(function(){
            //切换选择
            $(this).addClass('red').parent().siblings().find('a').removeClass('red');
        });
        $('#buy_goods_form .choicsel').each(function() {
            // 先默认每组的第一个单选按钮添加样式
            $(this).find('a').first().addClass('red');
            sel();
        });

        /**
         * 顶部导航切换
         */
        // $('.detail .search span').click(function(){
        //
        //     $(this).addClass('sxp').siblings().removeClass('sxp');
        //     var a = $('.detail .search span').index(this);
        //     $('.xq_details').eq(a).show().siblings('.xq_details').hide();
        //     $('.xq_details').eq(2).show();
        //     if($('.detail .search span').eq(2).hasClass('sxp')){
        //         $('.comment_de').show();
        //     }else{
        //         $('.comment_de').hide();
        //     }
        //     if($('.detail .search span').eq(1).hasClass('sxp')){
        //         $('.tab-con-wrapper').hide();
        //         $('.comment_con').hide();
        //     }else{
        //         $('.tab-con-wrapper').show();
        //         $('.comment_con').show();
        //     }
        // });

        /**
         * 内部导航切换
         */
        $('.spxq-ggcs ul li').click(function(){
            $(this).addClass('red').siblings().removeClass('red');
            var sg = $('.spxq-ggcs ul li').index(this);
            $(".swiper-container").css('height','')
            $(".swiper-wrapper").css('height','')
            $('.sg').eq(sg).show().siblings('.sg').hide();
            $('.sg').eq(sg).addClass('qiehuan');
            var $commentType= $(this).children('span').attr('ctype');
            //切换到评论按钮才加载评论列表
            if($('.detail .search span').eq(2).hasClass('sxp')){
                ajaxComment($commentType,1);// ajax 加载评价列表
            }
        });

        /**
         * 内部导航随鼠标滑动显示隐藏
         */
        var h1 = $('.detail').height();
        var h2 = $('.detail').height() + $('.spxq-ggcs').height();
        var ss = $(document).scrollTop();//上一次滚轮的高度
        $(window).scroll(function(){
            var s = $(document).scrollTop();////本次滚轮的高度
            if(s< h1){
                $('.spxq-ggcs').removeClass('po-fi');
            }if(s > h1){
                $('.spxq-ggcs').addClass('po-fi');
            }if(s > h2){
                $('.spxq-ggcs').addClass('gizle');
                if(s > ss){
                    $('.spxq-ggcs').removeClass('sabit');
                }else{
                    $('.spxq-ggcs').addClass('sabit');
                }
                ss = s;
            }
        });

        //在已选栏中显示默认选择属性，数量
        sel();

        /**
         * 更新商品价格
         */
        get_goods_price();

});
//完


    function switch_spec(spec)
    {
        $(spec).siblings().removeClass('hover');
        $(spec).addClass('hover');
        $(spec).siblings().children('input').prop('checked',false);
        $(spec).children('input').prop('checked',true);
        //更新商品价格
        get_goods_price();
    }

    function get_goods_price()
    {
        var goods_price = {$goods.shop_price}; // 商品起始价
        var store_count = {$goods.store_count}; // 商品起始库存
        var spec_goods_price = {$spec_goods_price};  // 规格 对应 价格 库存表   //alert(spec_goods_price['28_100']['price']);
        // 优先显示抢购活动库存
        <notempty name="goods['flash_sale']">
             store_count = {$goods['flash_sale']['goods_num'] - $goods['flash_sale']['buy_num'] - 1};
            var flash_sale_price = parseFloat("{$goods['flash_sale']['price']}");
            (flash_sale_price > 0) && (goods_price = flash_sale_price);
            spec_goods_price = null;
        </notempty>
        // 如果有属性选择项
        if(spec_goods_price != null && spec_goods_price !='')
        {
            goods_spec_arr = new Array();
            $("input[name^='goods_spec']:checked").each(function(){
                goods_spec_arr.push($(this).val());
            });
            var spec_key = goods_spec_arr.sort(sortNumber).join('_');  //排序后组合成 key
            goods_price = spec_goods_price[spec_key]['price']; // 找到对应规格的价格
            store_count = spec_goods_price[spec_key]['store_count']; // 找到对应规格的库存
        }
        var goods_num = parseInt($("#goods_num").val());
        // 库存不足的情况
        if(goods_num > store_count)
        {
            goods_num = store_count;
            alert('库存仅剩 '+store_count+' 件');
            $("#goods_num").val(goods_num);
        }
        $('#store_count').html(store_count);    //对应规格库存显示出来
        $('#number').attr('max',store_count); //对应规格最大库存
        if(goods_price > 0){
            $("#goods_price").html('<small>￥'+goods_price+'</small>'); // 变动价格显示
            $("#price").html('￥'+goods_price); // 变动价格显示
        }else{
            $("#goods_price").html('<small>￥'+'预约报价'+'</small>'); // 变动价格显示
            $("#price").html('￥'+'预约报价'); // 变动价格显示
        }

    }
    function sortNumber(a,b)
    {
        return a - b;
    }
    //运费
    $(function(){
        $('.remain').click(function(){
            $('#balance').toggle(300);
        })
        $('#balance').on('click','a',function(){
            $('#shipping_freight').text($(this).find('span').text());
            $('#balance').toggle(300);
        })
    })
</script>

<include file="public/wx_share"/>
</body>
</html>
